<?xml version="1.0"?>
  <database name="FUNCTION ALMAC_CRM_COMPLETASALIDA">
    <function name="ALMAC_CRM_COMPLETASALIDA" type="VARCHAR">
      <parameter name="p_inout_id" type="VARCHAR" mode="in">
        <default/>
      </parameter>
      <body><![CDATA[BEGIN 
	IF P_INOUT_ID IS NULL OR (SELECT M_INOUT_ID FROM M_INOUT WHERE M_INOUT_ID = P_INOUT_ID) IS NULL THEN
		RAISE_APPLICATION_ERROR(-20000, 'EL DOCUMENTO NO EXISTE');
	END IF; 

	IF (SELECT COUNT(*) AS C FROM M_INOUTLINE WHERE M_INOUT_ID = P_INOUT_ID) <= 0 THEN
		RAISE_APPLICATION_ERROR(-20000, 'EL DOCUMENTO NO TIENE LINEAS');
	END IF;

	--COMPLETA EL DOCUMENTO
	SELECT M_INOUT_POST(NULL,P_INOUT_ID);

	RETURN 'OK';
EXCEPTION 
WHEN OTHERS THEN
  RAISE;
END ALMAC_CRM_COMPLETASALIDA
]]></body>
    </function>
  </database>
