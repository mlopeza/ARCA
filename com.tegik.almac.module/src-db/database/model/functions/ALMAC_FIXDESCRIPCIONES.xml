<?xml version="1.0"?>
  <database name="FUNCTION ALMAC_FIXDESCRIPCIONES">
    <function name="ALMAC_FIXDESCRIPCIONES" type="NUMERIC">
      <parameter name="p_client_id" type="VARCHAR" mode="in">
        <default/>
      </parameter>
      <body><![CDATA[/*************************************************************************
************************************************************************/
  CUR_DESCRIPCIONES RECORD;
BEGIN

	FOR CUR_DESCRIPCIONES IN
	(SELECT M_ATTRIBUTESETINSTANCE_ID,  SUBSTRING(DESCRIPTION FROM 1 FOR 1) || A.NUMERO::integer AS NUEVO
	FROM 
		(SELECT M_ATTRIBUTESETINSTANCE_ID,
		DESCRIPTION,
		CASE
			WHEN SUBSTRING(DESCRIPTION FROM 1 FOR 1) = 'G' THEN SUBSTRING(DESCRIPTION FROM 3 FOR CHAR_LENGTH (DESCRIPTION) -2)
			ELSE SUBSTRING(DESCRIPTION FROM 2 FOR CHAR_LENGTH (DESCRIPTION) -1)
		END AS NUMERO
		FROM M_ATTRIBUTESETINSTANCE
		WHERE AD_CLIENT_ID = p_client_id) A
		)
	LOOP
		DBMS_OUTPUT.PUT_LINE( CUR_DESCRIPCIONES.NUEVO);
		UPDATE M_ATTRIBUTESETINSTANCE 
			SET EM_ALMAC_DESCRIPTIONBK = DESCRIPTION, DESCRIPTION = CUR_DESCRIPCIONES.NUEVO 
		WHERE M_ATTRIBUTESETINSTANCE_ID = CUR_DESCRIPCIONES.M_ATTRIBUTESETINSTANCE_ID;
	END LOOP;

RETURN 1;
	
EXCEPTION WHEN OTHERS THEN
  DBMS_OUTPUT.PUT_LINE(SQLERRM) ;
  RAISE;
END ALMAC_FIXDESCRIPCIONES
]]></body>
    </function>
  </database>
