<?xml version="1.0"?>
  <database name="VIEW ALMAC_CRM_INVENTARIO">
    <view name="ALMAC_CRM_INVENTARIO"><![CDATA[SELECT pa.almac_piezasalmacenadas_id AS almac_crm_inventario_id, pa.ad_client_id, pa.ad_org_id, pa.createdby, pa.updatedby, pa.created, pa.updated, pa.isactive, pa.m_attributesetinstance_id, pa.prefijo, pa.numero, cal.name AS calidad, pa.alto, pa.ancho, p.em_dmprod_depth AS espesor, p.em_almac_p_revisado AS producto_revisado,  CASE WHEN upper(p.em_dmprod_tileoslab) = 'SLAB' THEN 1 ELSE pa.m2 / (COALESCE(pa.alto, 1) * COALESCE(pa.ancho, 1)) END AS cantidad, pa.m2, p.m_product_id, p.name AS nombre_comercial, p.sku, pa.status, w.name AS almacen,  CASE WHEN cc.compra_contenedor_id IS NULL THEN 'NACIONAL' ELSE cc.documentno END AS contendor, pa.ventas_pickexecute_id, pe.pedido_cotizacion, COALESCE(pe.accion, 'NA') AS accion, almac_fecha_llegada(p.m_product_id, cc.compra_contenedor_id, w.m_warehouse_id, pa.em_almac_ingresado) AS almac_fecha_llegada FROM almac_piezasalmacenadas pa LEFT JOIN compra_contenedor cc ON cc.compra_contenedor_id = pa.compra_contenedor_id LEFT JOIN m_warehouse w ON w.m_warehouse_id = pa.m_warehouse_id LEFT JOIN m_product p ON p.m_product_id = pa.m_product_id AND (upper(p.em_dmprod_tileoslab) IN ('TILE', 'SLAB')) LEFT JOIN almac_calidad_p cal ON cal.almac_calidad_p_id = pa.em_almac_calidad_p_id LEFT JOIN ventas_pickexecute pe ON pe.ventas_pickexecute_id = pa.ventas_pickexecute_id]]></view>
  </database>
