<?xml version="1.0"?>
  <database name="VIEW ALMAC_VALOR_PALMACEN">
    <view name="ALMAC_VALOR_PALMACEN"><![CDATA[SELECT get_uuid() AS almac_valor_palmacen_id, sd.ad_client_id, sd.ad_org_id, wh.createdby, wh.updatedby, now() AS created, now() AS updated, wh.isactive, wh.m_warehouse_id, sd.m_product_id, round(sum(sd.qtyonhand), 4) AS cantidad_actual, round(sum(COALESCE(round(p.valor_producto, 4)) * COALESCE(sd.qtyonhand, 0)), 4) AS valor_total,  CASE WHEN round(sum(sd.qtyonhand), 4) = round(0, 4) OR sum(COALESCE(asi.em_almac_costo_realusd, 0) * COALESCE(sd.qtyonhand, 0)) = round(0, 4) THEN round(0, 4) ELSE round(COALESCE(sum(COALESCE(p.valor_producto, 0) * COALESCE(sd.qtyonhand, 0)), 0) / round(sum(sd.qtyonhand), 4), 4) END AS costo_promedio FROM m_storage_detail sd LEFT JOIN m_attributesetinstance asi ON asi.m_attributesetinstance_id = sd.m_attributesetinstance_id LEFT JOIN m_locator loc ON loc.m_locator_id = sd.m_locator_id LEFT JOIN m_warehouse wh ON wh.m_warehouse_id = loc.m_warehouse_id LEFT JOIN (SELECT m_product.m_product_id, m_product.ad_client_id, m_product.ad_org_id, m_product.isactive, m_product.created, m_product.createdby, m_product.updated, m_product.updatedby, m_product.value, m_product.name, m_product.description, m_product.documentnote, m_product.help, m_product.upc, m_product.sku, m_product.c_uom_id, m_product.salesrep_id, m_product.issummary, m_product.isstocked, m_product.ispurchased, m_product.issold, m_product.isbom, m_product.isinvoiceprintdetails, m_product.ispicklistprintdetails, m_product.isverified, m_product.m_product_category_id, m_product.classification, m_product.volume, m_product.weight, m_product.shelfwidth, m_product.shelfheight, m_product.shelfdepth, m_product.unitsperpallet, m_product.c_taxcategory_id, m_product.s_resource_id, m_product.discontinued, m_product.discontinuedby, m_product.processing, m_product.s_expensetype_id, m_product.producttype, m_product.imageurl, m_product.descriptionurl, m_product.guaranteedays, m_product.versionno, m_product.m_attributeset_id, m_product.m_attributesetinstance_id, m_product.downloadurl, m_product.m_freightcategory_id, m_product.m_locator_id, m_product.ad_image_id, m_product.c_bpartner_id, m_product.ispriceprinted, m_product.name2, m_product.costtype, m_product.coststd, m_product.stock_min, m_product.enforce_attribute, m_product.calculated, m_product.ma_processplan_id, m_product.production, m_product.capacity, m_product.delaymin, m_product.mrp_planner_id, m_product.mrp_planningmethod_id, m_product.qtymax, m_product.qtymin, m_product.qtystd, m_product.qtytype, m_product.stockmin, m_product.attrsetvaluetype, m_product.isquantityvariable, m_product.em_almac_fob_usd, m_product.em_almac_nombre_origen, m_product.em_almac_puertos_id, m_product.em_almac_c_currency_id, m_product.em_almac_disp_prod_id, m_product.em_almac_cat_piedra_id, m_product.em_almac_q_production_id, m_product.em_almac_cons_veta_id, m_product.em_almac_cons_ton_id, m_product.em_almac_tipo_medida_id, m_product.em_almac_seg_recom_id, m_product.em_almac_uso_recom_id, m_product.em_almac_aplicacion_id, m_product.em_almac_estilo_id, m_product.em_almac_p_revisado, m_product.em_almac_desperdicio, m_product.em_almac_rendimiento, m_product.em_almac_unidad, m_product.em_dmprod_tipopiedra_id, m_product.em_dmprod_uso_id, m_product.em_dmprod_areauso_id, m_product.em_dmprod_color_id, m_product.em_dmprod_country_id, m_product.em_dmprod_tileoslab, m_product.em_dmprod_acabado, m_product.em_dmprod_isoutlet, m_product.em_dmprod_height, m_product.em_dmprod_width, m_product.em_dmprod_isarancel, m_product.em_dmprod_preciofob, m_product.em_dmprod_arancel, m_product.em_dmprod_depth, m_product.em_ventas_isantic, almac_calcula_costo(m_product.m_product_id, NULL, NULL, 'DF', '0') AS valor_producto FROM m_product WHERE m_product.ad_client_id = '0BD13E24E0F94596B61414BD72225EB8') p ON p.m_product_id = sd.m_product_id WHERE sd.ad_client_id = '0BD13E24E0F94596B61414BD72225EB8' AND wh.isactive = 'Y' AND sd.isactive = 'Y' GROUP BY wh.createdby, wh.updatedby, wh.isactive, sd.ad_client_id, sd.ad_org_id, wh.m_warehouse_id, sd.m_product_id]]></view>
  </database>
