<?xml version="1.0"?>
  <database name="VIEW ALMAC_VALOR_PALMACEN">
    <view name="ALMAC_VALOR_PALMACEN"><![CDATA[SELECT get_uuid() AS almac_valor_palmacen_id, sd.ad_client_id, sd.ad_org_id, wh.createdby, wh.updatedby, now() AS created, now() AS updated, wh.isactive, wh.m_warehouse_id, sd.m_product_id, round(sum(sd.qtyonhand), 4) AS cantidad_actual, round(sum(COALESCE(asi.em_almac_costo_realusd, 0) * COALESCE(sd.qtyonhand, 0)), 4) AS valor_total,  CASE WHEN round(sum(sd.qtyonhand), 4) = round(0, 4) OR sum(COALESCE(asi.em_almac_costo_realusd, 0) * COALESCE(sd.qtyonhand, 0)) = round(0, 4) THEN round(0, 4) ELSE round(COALESCE(sum(COALESCE(asi.em_almac_costo_realusd, 0) * COALESCE(sd.qtyonhand, 0)), 0) / round(sum(sd.qtyonhand), 4), 4) END AS costo_promedio FROM m_storage_detail sd LEFT JOIN m_attributesetinstance asi ON asi.m_attributesetinstance_id = sd.m_attributesetinstance_id LEFT JOIN m_locator loc ON loc.m_locator_id = sd.m_locator_id LEFT JOIN m_warehouse wh ON wh.m_warehouse_id = loc.m_warehouse_id WHERE sd.ad_client_id = '0BD13E24E0F94596B61414BD72225EB8' AND wh.isactive = 'Y' AND sd.isactive = 'Y' GROUP BY wh.createdby, wh.updatedby, wh.isactive, sd.ad_client_id, sd.ad_org_id, wh.m_warehouse_id, sd.m_product_id]]></view>
  </database>
