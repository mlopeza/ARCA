<?xml version="1.0"?>
  <database name="VIEW ALMAC_CRM_PRODNOMCOM">
    <view name="ALMAC_CRM_PRODNOMCOM"><![CDATA[SELECT p.m_product_id AS almac_crm_prodnomcom_id, p.ad_client_id, p.ad_org_id, p.isactive, p.created, p.createdby, p.updated, p.updatedby, p.m_product_id, p.value AS sku, p.sku AS sku_arca, p.em_almac_p_revisado AS producto_revisado, p.em_dmprod_acabado AS acabado, pc.name AS categoria_piedra, round(p.em_dmprod_height, 4) AS largo, round(p.em_dmprod_width, 4) AS ancho, round(p.em_dmprod_depth, 4) AS espesor, round(almac_calcula_costo(p.m_product_id, NULL, NULL, 'DF', 'M'), 4) AS preciomin_usd_df, round(almac_calcula_costo(p.m_product_id, NULL, NULL, 'DF', 'I'), 4) AS precioideal_usd_df, round(almac_calcula_costo(p.m_product_id, NULL, NULL, 'MTY', 'M'), 4) AS preciomin_usd_mty, round(almac_calcula_costo(p.m_product_id, NULL, NULL, 'MTY', 'I'), 4) AS precioideal_usd_mty, p.em_dmprod_tileoslab AS formato, COALESCE(p.em_almac_fob_usd, 0) AS costo_fob_origen_usd, COALESCE(cp.dias_totales, 0) AS dias_transito_df, round(almac_calcula_costo(p.m_product_id, NULL, NULL, 'MTY', '0'), 4) AS c_usd_lab_df, COALESCE(p.em_dmprod_preciofob, 0) AS costo_origen, COALESCE(c.iso_code, 'NA') AS moneda_origen, COALESCE(co.name, 'NA') AS pais_origen FROM m_product p LEFT JOIN m_product_category pc ON pc.m_product_category_id = p.m_product_category_id LEFT JOIN (SELECT cp.m_product_id, apc.dias_transito + apc.dias_despacho AS dias_totales FROM almac_conex_prod cp JOIN almac_puertos_conexion apc ON apc.almac_puertos_conexion_id = cp.almac_puertos_conexion_id AND upper(apc.name) LIKE '%DF') cp ON cp.m_product_id = p.m_product_id LEFT JOIN c_currency c ON c.c_currency_id = p.em_almac_c_currency_id LEFT JOIN (SELECT c_country_trl.c_country_id, c_country_trl.name FROM c_country_trl WHERE c_country_trl.ad_language = 'es_ES') co ON co.c_country_id = p.em_dmprod_country_id WHERE p.isactive = 'Y' AND (upper(p.em_dmprod_tileoslab) IN ('TILE', 'SLAB'))]]></view>
  </database>
