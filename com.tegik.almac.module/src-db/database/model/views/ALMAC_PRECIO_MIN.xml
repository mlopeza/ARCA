<?xml version="1.0"?>
  <database name="VIEW ALMAC_PRECIO_MIN">
    <view name="ALMAC_PRECIO_MIN"><![CDATA[SELECT iol.m_inoutline_id AS almac_precio_min_id, io.ad_client_id, io.ad_org_id, iol.isactive, iol.updatedby AS actualizado_por, iol.createdby AS creado_por, iol.updatedby, iol.createdby, iol.updated, iol.created, iol.m_product_id,  CASE WHEN org.em_almac_esmty = 'Y' THEN p.min_mty WHEN org.em_almac_esdf = 'Y' THEN p.min_df ELSE 0 END AS precio_minimo, iol.em_almac_preciom2 AS precio_venta FROM m_inout io JOIN (SELECT m_inoutline.m_inout_id, m_inoutline.m_inoutline_id, m_inoutline.m_product_id, m_inoutline.ad_org_id, m_inoutline.createdby, m_inoutline.created, m_inoutline.updated, m_inoutline.updatedby, m_inoutline.isactive, round(COALESCE(m_inoutline.em_almac_preciom2, 0), 4) AS em_almac_preciom2 FROM m_inoutline WHERE m_inoutline.ad_client_id = '0BD13E24E0F94596B61414BD72225EB8') iol ON io.m_inout_id = iol.m_inout_id AND io.movementtype = 'C-' AND io.docstatus = 'CO' AND io.ad_client_id = '0BD13E24E0F94596B61414BD72225EB8' JOIN ad_org org ON org.ad_org_id = iol.ad_org_id JOIN (SELECT p.m_product_id, round(almac_calcula_costo(p.m_product_id, NULL, NULL, 'DF', 'M'), 4) AS min_df, round(almac_calcula_costo(p.m_product_id, NULL, NULL, 'MTY', 'M'), 4) AS min_mty FROM m_product p WHERE p.ad_client_id = '0BD13E24E0F94596B61414BD72225EB8' AND p.isactive = 'Y' AND (upper(p.em_dmprod_tileoslab) IN ('TILE', 'SLAB'))) p ON p.m_product_id = iol.m_product_id AND (iol.em_almac_preciom2 <  CASE WHEN org.em_almac_esmty = 'Y' THEN p.min_mty WHEN org.em_almac_esdf = 'Y' THEN p.min_df ELSE 0 END OR round(iol.em_almac_preciom2) = round(0, 4))]]></view>
  </database>
