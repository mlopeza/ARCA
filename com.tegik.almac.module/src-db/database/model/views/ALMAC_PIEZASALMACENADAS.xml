<?xml version="1.0"?>
  <database name="VIEW ALMAC_PIEZASALMACENADAS">
    <view name="ALMAC_PIEZASALMACENADAS"><![CDATA[SELECT  CASE WHEN COALESCE(asi.em_almac_ingresado, 'N') = 'Y' THEN sd.m_storage_detail_id ELSE pl.compra_packinglist_id END AS almac_piezasalmacenadas_id, asi.m_attributesetinstance_id, asi.em_almac_calidad_p_id, asi.ad_client_id, asi.ad_org_id, asi.createdby, asi.updatedby, asi.created, asi.updated, asi.isactive, 0.00 AS cantreservada, asi.em_almac_prefijo AS prefijo, asi.em_almac_numero AS numero, asi.em_ventas_pickexecute_id AS ventas_pickexecute_id, asi.em_almac_reservapedido AS reserva_pedido, asi.em_almac_reservacotizacion AS reserva_cotizacion,  CASE WHEN upper(p.em_dmprod_tileoslab) = 'SLAB' THEN asi.em_almac_alto ELSE p.em_dmprod_height END AS alto,  CASE WHEN upper(p.em_dmprod_tileoslab) = 'SLAB' THEN asi.em_almac_ancho ELSE p.em_dmprod_width END AS ancho, to_char('N') AS ob_selected,  CASE WHEN COALESCE(asi.em_almac_ingresado, 'N') = 'Y' THEN sd.qtyonhand ELSE pl.quantity END AS m2, p.m_product_id,  CASE WHEN COALESCE(asi.em_almac_ingresado, 'N') = 'Y' THEN wh.m_warehouse_id ELSE pl.m_warehouse_id END AS m_warehouse_id,  CASE WHEN COALESCE(asi.em_almac_ingresado, 'N') = 'Y' THEN 'ALMACENADO' ELSE 'TRANSITO' END AS status,  CASE WHEN COALESCE(asi.em_almac_ingresado, 'N') = 'Y' THEN asi.em_almac_com_contenedor_id ELSE pl.compra_contenedor_id END AS compra_contenedor_id, '0'(1) AS numero_pedido, '0'(1) AS numero_cotizacion, 0 AS cantidad, wh.em_almac_esmonterrey, wh.em_almac_esdf, wh.em_almac_esguadalajara, wh.em_almac_escancun FROM m_attributesetinstance asi LEFT JOIN (SELECT m_storage_detail.m_storage_detail_id, m_storage_detail.m_product_id, m_storage_detail.m_attributesetinstance_id, m_storage_detail.m_locator_id, m_storage_detail.qtyonhand FROM m_storage_detail WHERE round(m_storage_detail.qtyonhand, 4) > 0 AND m_storage_detail.m_attributesetinstance_id <> '0' AND m_storage_detail.ad_client_id = '0BD13E24E0F94596B61414BD72225EB8') sd ON sd.m_attributesetinstance_id = asi.m_attributesetinstance_id LEFT JOIN m_locator l ON l.m_locator_id = sd.m_locator_id LEFT JOIN m_warehouse wh ON wh.m_warehouse_id = l.m_warehouse_id LEFT JOIN (SELECT pl.m_attributesetinstance_id, pl.compra_packinglist_id, pl.quantity, pl.m_product_id, c.m_warehouse_id, c.compra_contenedor_id FROM compra_packinglist pl JOIN compra_contenedor c ON pl.compra_contenedor_id = c.compra_contenedor_id AND c.estado = 'CO') pl ON pl.m_attributesetinstance_id = asi.m_attributesetinstance_id LEFT JOIN m_product p ON p.m_product_id = COALESCE(sd.m_product_id, pl.m_product_id) WHERE  CASE WHEN COALESCE(asi.em_almac_ingresado, 'N') = 'Y' THEN sd.m_storage_detail_id ELSE pl.compra_packinglist_id END IS NOT NULL AND (upper(p.em_dmprod_tileoslab) IN ('TILE', 'SLAB')) AND p.isactive = 'Y']]></view>
  </database>
