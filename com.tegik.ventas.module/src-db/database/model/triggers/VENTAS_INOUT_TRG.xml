<?xml version="1.0"?>
  <database name="TRIGGER VENTAS_INOUT_TRG">
    <trigger name="VENTAS_INOUT_TRG" table="M_INOUT" fires="after" insert="true" update="true" delete="false" foreach="row">
      <body><![CDATA[CUR_DETALLE RECORD;
BEGIN
  IF AD_isTriggerEnabled()='N' THEN RETURN;
  END IF;

  IF (:NEW.DOCSTATUS = 'VO') THEN

	DELETE FROM VENTAS_HISTORIAL_DESGLOCE WHERE M_INOUTLINE_ID IN (SELECT M_INOUTLINE_ID FROM M_INOUTLINE WHERE M_INOUT_ID = :NEW.M_INOUT_ID) AND C_INVOICELINE_ID IS NULL;
	UPDATE VENTAS_HISTORIAL_DESGLOCE SET M_INOUTLINE_ID = NULL WHERE M_INOUTLINE_ID IN (SELECT M_INOUTLINE_ID FROM M_INOUTLINE WHERE M_INOUT_ID = :NEW.M_INOUT_ID);

  END IF;

END VENTAS_INOUT_TRG
]]></body>
    </trigger>
  </database>
