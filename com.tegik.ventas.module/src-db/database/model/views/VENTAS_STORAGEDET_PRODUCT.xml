<?xml version="1.0"?>
  <database name="VIEW VENTAS_STORAGEDET_PRODUCT">
    <view name="VENTAS_STORAGEDET_PRODUCT"><![CDATA[SELECT "substring"(p.m_product_id, 17) || "substring"(wh.m_warehouse_id, 17) AS ventas_storagedet_product_id, wh.ad_client_id, to_char('0') AS ad_org_id, wh.isactive, now() AS created, to_char('100') AS createdby, now() AS updated, to_char('100') AS updatedby, wh.m_warehouse_id, p.m_product_id, COALESCE((SELECT sum(sd2.qtyonhand) AS qtyonhand FROM m_storage_detail sd2 JOIN m_locator loc2 ON loc2.m_locator_id = sd2.m_locator_id WHERE sd2.m_product_id = p.m_product_id AND loc2.m_warehouse_id = wh.m_warehouse_id), 0) AS qtyonhand, COALESCE((SELECT sum(ol.qtyordered - ol.qtydelivered) AS qty_reservada FROM c_orderline ol JOIN c_order o ON o.c_order_id = ol.c_order_id AND o.docstatus = 'CO' AND o.issotrx = 'Y' WHERE (ol.qtyordered - ol.qtydelivered) > 0 AND ol.m_product_id = p.m_product_id AND o.m_warehouse_id = wh.m_warehouse_id), 0) AS qty_reservada FROM m_warehouse wh JOIN m_product p ON p.ad_client_id = wh.ad_client_id LEFT JOIN m_locator loc ON loc.m_warehouse_id = wh.m_warehouse_id LEFT JOIN m_storage_detail sd ON loc.m_locator_id = sd.m_locator_id WHERE wh.isactive = 'Y' GROUP BY wh.m_warehouse_id, p.m_product_id, wh.isactive, wh.ad_client_id]]></view>
  </database>
